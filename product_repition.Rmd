---
title: "product_repition"
author: "Tye Leckinger"
date: "4/16/2022"
output: html_document
---
Libraries
```{r libraries}
library(readxl)
library(tidyverse)
library(caret)
library(dplyr)
library(stringr)
library(knitr)
library(treemap)
```
Data Imports
```{r import, include=FALSE}
Summary_Basket_2019 <- read_csv("Summary_Basket_2019.csv")
Summary_Basket_2020 <- read_csv("Summary_Basket_2020.csv")
Summary_Basket_2021 <- read_csv("Summary_Basket_2021.csv")
UPC_Hack_Cereal2 <- read_csv("UPC_Hack_Cereal2.csv")
UPC_Hack_Cleaners2 <- read_csv("UPC_Hack_Cleaners2.csv")
Shopper_Tabs1 <- read_excel("Shopper_Tabs_1.xlsx")
Shopper_Tabs2 <- read_excel("Shopping_Tabs_2.xlsx")
Shopper_Tabs3 <- read_excel("Shopper_Tabs_3.xlsx")
Hackathon_Data_Maps <- read_excel("Hackathon_Data_Maps.xlsx")
#--------------------------------------------------------------
UPC_Hack_Cereal2 <- UPC_Hack_Cereal2 %>% 
      mutate(date = as.Date(str_c("20",date)))

```


```{r}
numToMonth<- function(num) {
  factor(c("January", 
    "February",
    "March",
    "April",
    "May",
    "June",
    "July",
    "August",
    "September",
    "October",
    "November",
    "December"),
    levels = c("January", 
    "February",
    "March",
    "April",
    "May",
    "June",
    "July",
    "August",
    "September",
    "October",
    "November",
    "December"))[num]
}
```




```{r}
cereal_bought <- UPC_Hack_Cereal2 %>%
  rename(UPC = "upc") %>%
  mutate(month = format(date, "%m") %>% 
           as.integer() %>% 
           numToMonth(), 
         year = format(date, "%y")) %>%
  group_by(UPC,month, year) %>%
  summarise(total_amount_bought = sum(qty))  %>%
  left_join(y = .,x = Hackathon_Data_Maps, by = "UPC") %>%
  filter(!is.na(total_amount_bought))

```

```{r Brand Popularity per month (2019,2020,2021)}
brand_bought <- cereal_bought %>%
  group_by(Brand,month, year) %>%
  summarise(total_bought_brand = sum(total_amount_bought))
#------------------------------- Year 2019
brand_bought %>% 
  filter(total_bought_brand > 5000) %>%
  filter(year == "19") %>%
ggplot(aes(x = reorder(Brand,total_bought_brand), y = total_bought_brand, fill = Brand)) + 
        theme (axis.text.x = element_blank(), axis.text.y=element_blank(), axis.ticks.x=element_blank(), legend.position="bottom") +
  geom_bar(stat = "identity")  + 
  facet_wrap(~month) +
  ggtitle("Year 2019")
#------------------------------- Year 2020
brand_bought %>% 
  filter(total_bought_brand > 5000) %>%
  filter(year == "20") %>%
ggplot(aes(x = reorder(Brand,total_bought_brand), y = total_bought_brand, fill = Brand)) + 
        theme (axis.text.x = element_blank(), axis.text.y=element_blank(), axis.ticks.x=element_blank(), legend.position="bottom") +
  geom_bar(stat = "identity") + 
  facet_wrap(~month) +
  ggtitle("Year 2020")
#------------------------------- Year 2021
brand_bought %>% 
  filter(total_bought_brand > 5000) %>%
  filter(year == "21") %>%
ggplot(aes(x = reorder(Brand,total_bought_brand), y = total_bought_brand, fill = Brand)) + 
        theme (axis.text.x = element_blank(), axis.text.y=element_blank(), axis.ticks.x=element_blank(), legend.position="bottom") +
  geom_bar(stat = "identity") + 
  facet_wrap(~month) +
  ggtitle("Year 2021")
```
```{r, floating brands}
brand_bought %>%
  group_by(Brand) %>%
  filter(year == "19") %>%
  filter(total_bought_brand > 5000) %>%
  count() %>%
  filter(n < 12)

brand_bought %>%
  group_by(Brand) %>%
  filter(year == "20") %>%
  filter(total_bought_brand > 5000) %>%
  count() %>%
  filter(n < 12)

brand_bought %>%
  group_by(Brand) %>%
  filter(year == "21") %>%
  filter(total_bought_brand > 5000) %>%
  count() %>%
  filter(n < 12)
```


